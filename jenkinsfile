pipeline {
    agent any
    environment {
        HEROKU_API_KEY = '480fb0de-15fe-4837-9a45-b877aba4dc4e'
        HEROKU_LOGIN = 'shaina3322@gmail.com'
    }
    stages {
         stage('Build') {
            steps {
                script {
                    docker.build("storybook_sb")
                }
            }
        }
       // stage('Test') {
        //    steps {
        //        script {
        //            bat 'npm test'
        //        }
        //    }
        //}
        stage('Deploy') {
            steps {
                bat 'echo $HEROKU_API_KEY'
                bat 'echo $HEROKU_LOGIN'
               // Login à Heroku
                bat 'heroku login -i'
                // Ajouter le remote Heroku (si ce n'est pas déjà fait)
                bat 'git remote add heroku https://git.heroku.com/storybooksbk'

                // Pousser sur Heroku pour déclencher le déploiement
                bat 'git push heroku master'

                // Taguer l'image Docker pour le registry Heroku
                bat 'docker tag storybook_sb registry.heroku.com/storybooksbk/web'

                // Pousser l'image sur le registry Heroku
                bat 'docker push registry.heroku.com/storybooksbk/web'

                // Libérer l'image sur Heroku
                bat 'heroku container:release web --app storybooksbk'
            }
        }
    }
}
