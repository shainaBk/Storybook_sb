pipeline {
    environment {
        HEROKU_API_KEY = 'votre_clé_api_heroku',
        HEROKU_LOGIN = ' '
    }
    agent any
    stages {
         stage('Build') {
            steps {
                script {
                    docker.build("storybook_sb")
                }
            }
        }
       // stage('Test') {
        //    steps {
        //        script {
        //            bat 'npm test'
        //        }
        //    }
        //}
        stage('Deploy') {
            steps {
                bat 'echo $HEROKU_API_KEY'
                bat 'echo $HEROKU_LOGIN'
               // Login à Heroku
               bat 'docker login --username=shaina3322@gmail.com --password-stdin registry.heroku.com'

                // Taguer l'image Docker pour le registry Heroku
                bat 'docker tag storybook_sb registry.heroku.com/storybooksbk/web'

                // Pousser l'image sur le registry Heroku
                bat 'docker push registry.heroku.com/storybooksbk/web'

                // Libérer l'image sur Heroku
                bat 'heroku container:release web --app storybooksbk'
            }
        }
    }
}
